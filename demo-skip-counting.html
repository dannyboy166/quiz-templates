<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skip Counting - Quiz Template</title>
  <link rel="stylesheet" href="css/base.css">
  <style>
    body {
      background: #87CEEB;
    }

    .skip-info {
      text-align: center;
      margin-bottom: 20px;
    }

    .skip-badge {
      display: inline-block;
      background: white;
      padding: 10px 24px;
      border-radius: 30px;
      font-size: 22px;
      font-weight: 700;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .skip-badge span {
      color: #E91E63;
    }

    .number-sequence {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 30px;
    }

    .number-box {
      width: 70px;
      height: 70px;
      background: white;
      border: 4px solid #4CAF50;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: 700;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .number-box.given {
      background: #E8F5E9;
      border-color: #4CAF50;
    }

    .number-box.blank {
      background: #FFF9C4;
      border-style: dashed;
      border-color: #FF9800;
    }

    .number-input {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      text-align: center;
      font-size: 32px;
      font-weight: 700;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }

    .number-input:focus {
      outline: none;
    }

    .number-box.correct {
      background: #C8E6C9;
      border-color: #4CAF50;
      border-style: solid;
    }

    .number-box.incorrect {
      background: #FFCDD2;
      border-color: #F44336;
      border-style: solid;
    }

    /* Pattern selector */
    .pattern-selector {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    .pattern-btn {
      padding: 8px 20px;
      font-size: 18px;
      font-weight: 700;
      background: white;
      border: 3px solid #9C27B0;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pattern-btn:hover {
      background: #F3E5F5;
    }

    .pattern-btn.active {
      background: #9C27B0;
      color: white;
    }

    /* Feedback */
    .feedback {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-top: 20px;
    }

    .feedback.show {
      display: flex;
    }

    .feedback-badge {
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .feedback-badge.correct {
      background: #C8E6C9;
      border: 2px solid #66BB6A;
      color: #2E7D32;
    }

    .feedback-badge.incorrect {
      background: #FFCDD2;
      border: 2px solid #E57373;
      color: #C62828;
    }

    .btn-try-again {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      background: #FF9800;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .btn-try-again:hover {
      background: #F57C00;
    }

    .btn-next {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #4CAF50;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .btn-next:hover {
      background: #43A047;
    }

    .progress-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
    }

    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ddd;
    }

    .progress-dot.correct { background: #4CAF50; }
    .progress-dot.incorrect { background: #F44336; }
    .progress-dot.current { background: #9C27B0; transform: scale(1.3); }

    .score-display {
      text-align: center;
      margin-top: 15px;
      font-size: 16px;
      color: #666;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.show { display: flex; }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      border: none;
      background: #eee;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
    }

    .modal-content h2 { margin-bottom: 20px; }

    .modal-instruction {
      background: #FFF9E6;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: left;
    }

    .modal-instruction p { margin-bottom: 10px; }

    .modal-btn {
      padding: 12px 30px;
      font-size: 16px;
      font-weight: 600;
      background: #333;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .btn-check-answer {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <!-- Header -->
    <header class="quiz-header">
      <button class="btn-back" onclick="window.location.href='index.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </button>

      <div class="user-profile">
        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" class="user-avatar">
        <div class="progress-bar-container">
          <div class="progress-bar-fill" style="width: 40%"></div>
        </div>
      </div>

      <button class="btn-help" id="header-help">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        Help
      </button>
    </header>

    <!-- Pattern Selector -->
    <div class="pattern-selector">
      <button class="pattern-btn active" data-skip="2">Count by 2s</button>
      <button class="pattern-btn" data-skip="5">Count by 5s</button>
      <button class="pattern-btn" data-skip="10">Count by 10s</button>
      <button class="pattern-btn" data-skip="3">Count by 3s</button>
    </div>

    <!-- Question Meta -->
    <div class="question-meta">
      <span class="badge badge-math">Maths</span>
      <span class="question-progress">Question <span id="current-q">1</span> of <span id="total-q">6</span></span>
    </div>

    <!-- Question Title -->
    <div class="question-title">
      <button class="btn-read-aloud" id="btn-read-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
        </svg>
      </button>
      <h1 id="question-text">Fill in the missing numbers</h1>
    </div>

    <!-- Help Bar -->
    <div class="help-bar">
      <div class="help-item" id="btn-read-aloud">
        <span class="help-item-icon">üîä</span>
        <span>Read Aloud</span>
      </div>
      <span class="help-item-line"></span>
      <div class="help-item" id="btn-get-help">
        <span class="help-item-icon">‚ùì</span>
        <span>Get Help</span>
      </div>
      <span class="help-item-line"></span>
      <div class="help-item" id="btn-get-hint">
        <span class="help-item-icon">üí°</span>
        <span>Get Hint</span>
      </div>
    </div>

    <!-- Content Card -->
    <div class="content-card">
      <div class="content-card-inner">
        <div class="skip-info">
          <div class="skip-badge">Skip counting by <span id="skip-number">2</span>s</div>
        </div>

        <div class="number-sequence" id="number-sequence">
          <!-- Numbers will be inserted here -->
        </div>

        <button class="btn-check-answer" id="btn-check">Check Answer</button>

        <div class="feedback" id="feedback">
          <div class="feedback-badge" id="feedback-badge">
            <span id="feedback-icon">‚úì</span>
            <span id="feedback-text">Correct!</span>
          </div>
          <button class="btn-try-again" id="btn-try-again">Try Again</button>
          <button class="btn-next" id="btn-next">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>

        <div class="progress-dots" id="progress-dots"></div>
        <div class="score-display" id="score-display"></div>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal-overlay" id="help-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('help-modal')">√ó</button>
      <h2>How to Play</h2>
      <div class="modal-instruction">
        <p>üî¢ Look at the number pattern</p>
        <p>üìà Figure out what number we're counting by</p>
        <p>‚úèÔ∏è Type the missing numbers in the yellow boxes</p>
        <p>üí° <strong>Counting by 2s:</strong> 2, 4, 6, 8, 10...</p>
        <p>üí° <strong>Counting by 5s:</strong> 5, 10, 15, 20...</p>
        <p>üí° <strong>Counting by 10s:</strong> 10, 20, 30, 40...</p>
        <p>‚úÖ Press "Check Answer" when you're done!</p>
      </div>
      <button class="modal-btn" onclick="closeModal('help-modal')">Got it!</button>
    </div>
  </div>

  <!-- Hint Modal -->
  <div class="modal-overlay" id="hint-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('hint-modal')">√ó</button>
      <h2>üí° Hint</h2>
      <div class="modal-instruction">
        <p id="hint-text">Add the skip number to the previous number!</p>
      </div>
      <button class="modal-btn" onclick="closeModal('hint-modal')">Thanks!</button>
    </div>
  </div>

  <script>
    // Generate questions for each skip pattern
    function generateQuestions(skipBy) {
      const questions = [];

      for (let i = 0; i < 6; i++) {
        // Random starting point
        const start = skipBy * (Math.floor(Math.random() * 5) + 1);
        const length = 7; // 7 numbers in sequence
        const sequence = [];

        for (let j = 0; j < length; j++) {
          sequence.push(start + (skipBy * j));
        }

        // Randomly choose 2-3 blanks (not first or last)
        const numBlanks = Math.floor(Math.random() * 2) + 2; // 2-3 blanks
        const blankIndices = new Set();

        while (blankIndices.size < numBlanks) {
          const idx = Math.floor(Math.random() * (length - 2)) + 1; // 1 to length-2
          blankIndices.add(idx);
        }

        questions.push({
          sequence,
          blanks: Array.from(blankIndices).sort((a, b) => a - b)
        });
      }

      return questions;
    }

    let currentSkip = 2;
    let questions = generateQuestions(currentSkip);
    let currentQuestion = 0;
    let results = [];
    let correctCount = 0;

    function init() {
      renderProgressDots();
      loadQuestion(currentQuestion);
      setupEventListeners();
    }

    function renderProgressDots() {
      const container = document.getElementById('progress-dots');
      container.innerHTML = questions.map((_, i) =>
        `<div class="progress-dot ${i === 0 ? 'current' : ''}" data-index="${i}"></div>`
      ).join('');
    }

    function loadQuestion(index) {
      const q = questions[index];

      // Update progress
      document.getElementById('current-q').textContent = index + 1;
      document.getElementById('total-q').textContent = questions.length;

      // Update skip number display
      document.getElementById('skip-number').textContent = currentSkip;

      // Update hint
      document.getElementById('hint-text').textContent =
        `Each number is ${currentSkip} more than the last. Look at the numbers before and after the blanks!`;

      // Render sequence
      renderSequence(q);

      // Update progress dots
      document.querySelectorAll('.progress-dot').forEach((dot, i) => {
        dot.classList.remove('current');
        if (i === index) dot.classList.add('current');
        if (results[i] === true) dot.classList.add('correct');
        if (results[i] === false) dot.classList.add('incorrect');
      });

      // Reset UI
      document.getElementById('btn-check').style.display = 'block';
      document.getElementById('feedback').classList.remove('show');
      updateScore();
    }

    function renderSequence(q) {
      const container = document.getElementById('number-sequence');

      container.innerHTML = q.sequence.map((num, i) => {
        if (q.blanks.includes(i)) {
          return `
            <div class="number-box blank">
              <input type="text" class="number-input" data-index="${i}" data-answer="${num}"
                     inputmode="numeric" maxlength="3" placeholder="?">
            </div>
          `;
        }
        return `<div class="number-box given">${num}</div>`;
      }).join('');

      // Add input event listeners
      container.querySelectorAll('.number-input').forEach(input => {
        input.addEventListener('input', (e) => {
          e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 3);
        });
      });
    }

    function checkAnswer() {
      const inputs = document.querySelectorAll('.number-input');
      let allCorrect = true;

      inputs.forEach(input => {
        const userAnswer = parseInt(input.value);
        const correctAnswer = parseInt(input.dataset.answer);
        const box = input.parentElement;

        if (userAnswer === correctAnswer) {
          box.classList.remove('blank');
          box.classList.add('correct');
        } else {
          box.classList.remove('blank');
          box.classList.add('incorrect');
          input.value = correctAnswer; // Show correct answer
          allCorrect = false;
        }
        input.readOnly = true;
      });

      results[currentQuestion] = allCorrect;
      if (allCorrect) correctCount++;

      // Show feedback
      const feedback = document.getElementById('feedback');
      const badge = document.getElementById('feedback-badge');
      const icon = document.getElementById('feedback-icon');
      const text = document.getElementById('feedback-text');
      const tryAgain = document.getElementById('btn-try-again');
      const next = document.getElementById('btn-next');

      badge.className = 'feedback-badge ' + (allCorrect ? 'correct' : 'incorrect');
      icon.textContent = allCorrect ? '‚úì' : '‚úó';
      text.textContent = allCorrect ? 'Correct!' : 'Not quite!';

      tryAgain.style.display = allCorrect ? 'none' : 'inline-block';
      next.style.display = 'flex';

      document.getElementById('btn-check').style.display = 'none';
      feedback.classList.add('show');

      // Update progress dot
      const dot = document.querySelector(`.progress-dot[data-index="${currentQuestion}"]`);
      dot.classList.add(allCorrect ? 'correct' : 'incorrect');

      updateScore();

      // Read aloud
      if ('speechSynthesis' in window) {
        const q = questions[currentQuestion];
        const utterance = new SpeechSynthesisUtterance(
          allCorrect ? 'Correct! Well done!' : `The pattern is ${q.sequence.join(', ')}`
        );
        utterance.rate = 0.8;
        speechSynthesis.speak(utterance);
      }
    }

    function updateScore() {
      const total = results.length;
      if (total > 0) {
        document.getElementById('score-display').textContent = `Score: ${correctCount}/${total}`;
      } else {
        document.getElementById('score-display').textContent = '';
      }
    }

    function tryAgain() {
      results[currentQuestion] = undefined;
      loadQuestion(currentQuestion);
    }

    function nextQuestion() {
      if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        loadQuestion(currentQuestion);
      } else {
        alert(`üéâ Well done!\n\nYou got ${correctCount} out of ${questions.length} correct!`);
      }
    }

    function switchPattern(skipBy) {
      currentSkip = skipBy;
      currentQuestion = 0;
      results = [];
      correctCount = 0;
      questions = generateQuestions(skipBy);

      // Update buttons
      document.querySelectorAll('.pattern-btn').forEach(btn => {
        btn.classList.toggle('active', parseInt(btn.dataset.skip) === skipBy);
      });

      renderProgressDots();
      loadQuestion(0);
    }

    function readAloud() {
      if ('speechSynthesis' in window) {
        const q = questions[currentQuestion];
        const spoken = q.sequence.map((num, i) =>
          q.blanks.includes(i) ? 'blank' : num
        ).join(', ');

        const utterance = new SpeechSynthesisUtterance(
          `Count by ${currentSkip}s. Fill in the missing numbers: ${spoken}`
        );
        utterance.rate = 0.8;
        speechSynthesis.speak(utterance);
      }
    }

    function openModal(id) { document.getElementById(id).classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    function setupEventListeners() {
      document.getElementById('btn-check').addEventListener('click', checkAnswer);
      document.getElementById('btn-try-again').addEventListener('click', tryAgain);
      document.getElementById('btn-next').addEventListener('click', nextQuestion);
      document.getElementById('btn-read-aloud').addEventListener('click', readAloud);
      document.getElementById('btn-read-title').addEventListener('click', readAloud);
      document.getElementById('btn-get-help').addEventListener('click', () => openModal('help-modal'));
      document.getElementById('header-help').addEventListener('click', () => openModal('help-modal'));
      document.getElementById('btn-get-hint').addEventListener('click', () => openModal('hint-modal'));

      // Pattern selector
      document.querySelectorAll('.pattern-btn').forEach(btn => {
        btn.addEventListener('click', () => switchPattern(parseInt(btn.dataset.skip)));
      });

      document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeModal(modal.id);
        });
      });
    }

    init();
  </script>
</body>
</html>
