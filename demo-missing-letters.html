<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Missing Letters - Quiz Template</title>
  <link rel="stylesheet" href="css/base.css">
  <style>
    body {
      background: #F2ADE2;
    }

    .word-display {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 4px;
      margin-bottom: 40px;
    }

    .letter-box {
      width: 60px;
      height: 70px;
      background: white;
      border: 3px solid #333;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 42px;
      font-weight: 700;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-transform: lowercase;
    }

    .letter-box.blank {
      background: #FFF9C4;
      border-style: dashed;
      border-color: #FF9800;
    }

    .letter-box.blank.filled {
      background: #E1BEE7;
      border-style: solid;
      border-color: #9C27B0;
    }

    .letter-box.blank.correct {
      background: #C8E6C9;
      border-color: #4CAF50;
    }

    .letter-box.blank.incorrect {
      background: #FFCDD2;
      border-color: #F44336;
    }

    .options-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .option-btn {
      min-width: 120px;
      padding: 20px 40px;
      font-size: 32px;
      font-weight: 700;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: white;
      border: 4px solid #333;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: lowercase;
    }

    .option-btn:hover {
      transform: scale(1.05);
      background: #F3E5F5;
    }

    .option-btn.selected {
      background: #E1BEE7;
      border-color: #9C27B0;
      transform: scale(1.05);
    }

    .option-btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .rule-hint {
      background: #FFF9E6;
      border: 2px solid #FFE082;
      border-radius: 12px;
      padding: 16px 24px;
      margin-bottom: 24px;
      text-align: center;
      font-size: 18px;
    }

    .rule-hint strong {
      color: #E91E63;
    }

    .word-meaning {
      text-align: center;
      font-size: 16px;
      color: #666;
      margin-top: -30px;
      margin-bottom: 30px;
      font-style: italic;
    }

    /* Feedback styles */
    .feedback {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-top: 20px;
    }

    .feedback.show {
      display: flex;
    }

    .feedback-badge {
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .feedback-badge.correct {
      background: #C8E6C9;
      border: 2px solid #66BB6A;
      color: #2E7D32;
    }

    .feedback-badge.incorrect {
      background: #FFCDD2;
      border: 2px solid #E57373;
      color: #C62828;
    }

    .btn-try-again {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      background: #FF9800;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-try-again:hover {
      background: #F57C00;
    }

    .btn-next {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #4CAF50;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: all 0.2s;
    }

    .btn-next:hover {
      background: #43A047;
      transform: scale(1.1);
    }

    .progress-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
    }

    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ddd;
      transition: background 0.3s;
    }

    .progress-dot.correct {
      background: #4CAF50;
    }

    .progress-dot.incorrect {
      background: #F44336;
    }

    .progress-dot.current {
      background: #9C27B0;
      transform: scale(1.3);
    }

    /* Help Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      border: none;
      background: #eee;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content h2 {
      margin-bottom: 20px;
      font-size: 24px;
    }

    .modal-instruction {
      background: #FFF9E6;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: left;
    }

    .modal-instruction p {
      margin-bottom: 12px;
      font-size: 16px;
    }

    .modal-instruction ul {
      margin-left: 20px;
    }

    .modal-instruction li {
      margin-bottom: 8px;
    }

    .modal-btn {
      padding: 12px 30px;
      font-size: 16px;
      font-weight: 600;
      background: #333;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <!-- Header -->
    <header class="quiz-header">
      <button class="btn-back" onclick="window.location.href='index.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </button>

      <div class="user-profile">
        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" class="user-avatar">
        <div class="progress-bar-container">
          <div class="progress-bar-fill" style="width: 45%"></div>
        </div>
      </div>

      <button class="btn-help" id="header-help">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        Help
      </button>
    </header>

    <!-- Question Meta -->
    <div class="question-meta">
      <span class="badge badge-english">English</span>
      <span class="question-progress">Question <span id="current-q">1</span> of <span id="total-q">8</span></span>
    </div>

    <!-- Question Title -->
    <div class="question-title">
      <button class="btn-read-aloud" id="btn-read-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
        </svg>
      </button>
      <h1 id="question-text">Choose the missing letters!</h1>
    </div>

    <!-- Help Bar -->
    <div class="help-bar">
      <div class="help-item" id="btn-read-aloud">
        <span class="help-item-icon">üîä</span>
        <span>Read Aloud</span>
      </div>
      <span class="help-item-line"></span>
      <div class="help-item" id="btn-get-help">
        <span class="help-item-icon">‚ùì</span>
        <span>Get Help</span>
      </div>
      <span class="help-item-line"></span>
      <div class="help-item" id="btn-get-hint">
        <span class="help-item-icon">üí°</span>
        <span>Get Hint</span>
      </div>
    </div>

    <!-- Rule Hint -->
    <div class="rule-hint" id="rule-hint">
      <strong>Remember:</strong> "i before e, except after c"
    </div>

    <!-- Content Card -->
    <div class="content-card">
      <div class="content-card-inner">
        <!-- Word Display -->
        <div class="word-display" id="word-display">
          <!-- Letters will be inserted here -->
        </div>

        <!-- Word Meaning -->
        <div class="word-meaning" id="word-meaning">to think something is true</div>

        <!-- Options -->
        <div class="options-container" id="options-container">
          <!-- Options will be inserted here -->
        </div>

        <!-- Check Button -->
        <button class="btn-check-answer" id="btn-check">Check Answer</button>

        <!-- Feedback -->
        <div class="feedback" id="feedback">
          <div class="feedback-badge" id="feedback-badge">
            <span id="feedback-icon">‚úì</span>
            <span id="feedback-text">Correct!</span>
          </div>
          <button class="btn-try-again" id="btn-try-again">Try Again</button>
          <button class="btn-next" id="btn-next">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>

        <!-- Progress Dots -->
        <div class="progress-dots" id="progress-dots">
          <!-- Dots will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal-overlay" id="help-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('help-modal')">√ó</button>
      <h2>How to Play</h2>
      <div class="modal-instruction">
        <p>üî§ Look at the word with missing letters.</p>
        <p>ü§î Choose which letters complete the word correctly.</p>
        <p>üìè <strong>The Rule:</strong> "i before e, except after c"</p>
        <ul>
          <li><strong>ie</strong> - most words use "ie" (believe, friend, thief)</li>
          <li><strong>ei</strong> - use "ei" after the letter "c" (receive, ceiling, deceive)</li>
        </ul>
        <p>‚ö†Ô∏è Some words are exceptions - learn them by heart!</p>
      </div>
      <button class="modal-btn" onclick="closeModal('help-modal')">Got it!</button>
    </div>
  </div>

  <!-- Hint Modal -->
  <div class="modal-overlay" id="hint-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('hint-modal')">√ó</button>
      <h2>üí° Hint</h2>
      <div class="modal-instruction">
        <p id="hint-text">Look at the letter before the blank. Is it a "c"?</p>
      </div>
      <button class="modal-btn" onclick="closeModal('hint-modal')">Thanks!</button>
    </div>
  </div>

  <script>
    // Question data - "i before e except after c" practice
    const questions = [
      {
        word: "believe",
        blank: [3, 4], // positions of missing letters (0-indexed)
        options: ["ie", "ei"],
        correct: "ie",
        meaning: "to think something is true",
        hint: "There's no 'c' before the blank, so use the normal rule!"
      },
      {
        word: "receive",
        blank: [3, 4],
        options: ["ie", "ei"],
        correct: "ei",
        meaning: "to get something given to you",
        hint: "Look! There's a 'c' right before the blank..."
      },
      {
        word: "friend",
        blank: [2, 3],
        options: ["ie", "ei"],
        correct: "ie",
        meaning: "someone you like and trust",
        hint: "No 'c' before the blank - use the normal rule!"
      },
      {
        word: "ceiling",
        blank: [1, 2],
        options: ["ie", "ei"],
        correct: "ei",
        meaning: "the top surface of a room",
        hint: "The letter before the blank is 'c'!"
      },
      {
        word: "thief",
        blank: [2, 3],
        options: ["ie", "ei"],
        correct: "ie",
        meaning: "someone who steals things",
        hint: "Is there a 'c' before the blank? No!"
      },
      {
        word: "deceive",
        blank: [3, 4],
        options: ["ie", "ei"],
        correct: "ei",
        meaning: "to trick someone",
        hint: "Check the letter right before the blank - it's 'c'!"
      },
      {
        word: "piece",
        blank: [1, 2],
        options: ["ie", "ei"],
        correct: "ie",
        meaning: "a part of something",
        hint: "The letter before is 'p', not 'c' - use normal rule!"
      },
      {
        word: "achieve",
        blank: [3, 4],
        options: ["ie", "ei"],
        correct: "ie",
        meaning: "to succeed at something",
        hint: "The letter before the blank is 'h', not 'c'!"
      }
    ];

    let currentQuestion = 0;
    let selectedOption = null;
    let results = [];

    // Initialize
    function init() {
      renderProgressDots();
      loadQuestion(currentQuestion);
      setupEventListeners();
    }

    function renderProgressDots() {
      const container = document.getElementById('progress-dots');
      container.innerHTML = questions.map((_, i) =>
        `<div class="progress-dot ${i === 0 ? 'current' : ''}" data-index="${i}"></div>`
      ).join('');
    }

    function loadQuestion(index) {
      const q = questions[index];
      selectedOption = null;

      // Update progress
      document.getElementById('current-q').textContent = index + 1;
      document.getElementById('total-q').textContent = questions.length;

      // Update progress dots
      document.querySelectorAll('.progress-dot').forEach((dot, i) => {
        dot.classList.remove('current');
        if (i === index) dot.classList.add('current');
        if (results[i] === true) dot.classList.add('correct');
        if (results[i] === false) dot.classList.add('incorrect');
      });

      // Render word with blanks
      renderWord(q);

      // Render options
      renderOptions(q.options);

      // Update meaning
      document.getElementById('word-meaning').textContent = q.meaning;

      // Update hint
      document.getElementById('hint-text').textContent = q.hint;

      // Reset UI
      document.getElementById('btn-check').style.display = 'block';
      document.getElementById('feedback').classList.remove('show');

      // Enable options
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.disabled = false;
        btn.classList.remove('selected');
      });
    }

    function renderWord(q) {
      const container = document.getElementById('word-display');
      const letters = q.word.split('');

      container.innerHTML = letters.map((letter, i) => {
        if (q.blank.includes(i)) {
          return `<div class="letter-box blank" data-index="${i}">_</div>`;
        }
        return `<div class="letter-box">${letter}</div>`;
      }).join('');
    }

    function renderOptions(options) {
      const container = document.getElementById('options-container');
      container.innerHTML = options.map(opt =>
        `<button class="option-btn" data-option="${opt}">${opt}</button>`
      ).join('');

      // Add click handlers
      container.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', () => selectOption(btn));
      });
    }

    function selectOption(btn) {
      if (btn.disabled) return;

      // Deselect others
      document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));

      // Select this one
      btn.classList.add('selected');
      selectedOption = btn.dataset.option;

      // Fill in the blanks
      const q = questions[currentQuestion];
      const letters = selectedOption.split('');
      q.blank.forEach((pos, i) => {
        const box = document.querySelector(`.letter-box.blank[data-index="${pos}"]`);
        if (box && letters[i]) {
          box.textContent = letters[i];
          box.classList.add('filled');
        }
      });
    }

    function checkAnswer() {
      if (!selectedOption) {
        alert('Please choose an option first!');
        return;
      }

      const q = questions[currentQuestion];
      const isCorrect = selectedOption === q.correct;
      results[currentQuestion] = isCorrect;

      // Update blanks styling
      document.querySelectorAll('.letter-box.blank').forEach(box => {
        box.classList.remove('filled');
        box.classList.add(isCorrect ? 'correct' : 'incorrect');
      });

      // Disable options
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.disabled = true;
      });

      // Show feedback
      const feedback = document.getElementById('feedback');
      const badge = document.getElementById('feedback-badge');
      const icon = document.getElementById('feedback-icon');
      const text = document.getElementById('feedback-text');
      const tryAgain = document.getElementById('btn-try-again');
      const next = document.getElementById('btn-next');

      badge.className = 'feedback-badge ' + (isCorrect ? 'correct' : 'incorrect');
      icon.textContent = isCorrect ? '‚úì' : '‚úó';
      text.textContent = isCorrect ? 'Correct!' : `It's "${q.correct}"`;

      tryAgain.style.display = isCorrect ? 'none' : 'inline-block';
      next.style.display = isCorrect ? 'flex' : 'none';

      document.getElementById('btn-check').style.display = 'none';
      feedback.classList.add('show');

      // Update progress dot
      const dot = document.querySelector(`.progress-dot[data-index="${currentQuestion}"]`);
      dot.classList.add(isCorrect ? 'correct' : 'incorrect');

      // Read aloud feedback
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(
          isCorrect ? `Correct! ${q.word}` : `The answer is ${q.correct}. ${q.word}`
        );
        utterance.rate = 0.8;
        speechSynthesis.speak(utterance);
      }
    }

    function tryAgain() {
      loadQuestion(currentQuestion);
    }

    function nextQuestion() {
      if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        loadQuestion(currentQuestion);
      } else {
        // Quiz complete
        const correct = results.filter(r => r === true).length;
        alert(`Quiz Complete!\n\nYou got ${correct} out of ${questions.length} correct!`);
      }
    }

    function readAloud() {
      if ('speechSynthesis' in window) {
        const q = questions[currentQuestion];
        // Read the word with blanks as "blank"
        const letters = q.word.split('');
        let spoken = '';
        letters.forEach((letter, i) => {
          if (q.blank.includes(i)) {
            if (!spoken.endsWith('blank ')) spoken += 'blank ';
          } else {
            spoken += letter;
          }
        });

        const utterance = new SpeechSynthesisUtterance(
          `Choose the missing letters. ${spoken}. ${q.meaning}`
        );
        utterance.rate = 0.8;
        speechSynthesis.speak(utterance);
      }
    }

    function openModal(id) {
      document.getElementById(id).classList.add('show');
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('show');
    }

    function setupEventListeners() {
      document.getElementById('btn-check').addEventListener('click', checkAnswer);
      document.getElementById('btn-try-again').addEventListener('click', tryAgain);
      document.getElementById('btn-next').addEventListener('click', nextQuestion);
      document.getElementById('btn-read-aloud').addEventListener('click', readAloud);
      document.getElementById('btn-read-title').addEventListener('click', readAloud);
      document.getElementById('btn-get-help').addEventListener('click', () => openModal('help-modal'));
      document.getElementById('header-help').addEventListener('click', () => openModal('help-modal'));
      document.getElementById('btn-get-hint').addEventListener('click', () => openModal('hint-modal'));

      // Close modals on overlay click
      document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeModal(modal.id);
        });
      });
    }

    // Start
    init();
  </script>
</body>
</html>
