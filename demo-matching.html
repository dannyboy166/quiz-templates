<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matching Lines - Quiz Template</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/clock.css">
  <link rel="stylesheet" href="css/drag-drop.css">
  <style>
    .matching-container {
      position: relative;
      padding: 20px;
    }

    .matching-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
    }

    .matching-column {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .matching-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .matching-item.left {
      flex-direction: row;
    }

    .matching-item.right {
      flex-direction: row-reverse;
    }

    .matching-item:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .matching-item.selected {
      background: #E3F2FD;
    }

    .matching-item.matched {
      background: var(--correct-bg);
    }

    .matching-item.incorrect {
      background: var(--incorrect-bg);
    }

    .match-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #333;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      flex-shrink: 0;
    }

    .match-dot:hover {
      transform: scale(1.2);
      box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.3);
    }

    .match-dot.selected {
      background: #2196F3;
      box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.3);
    }

    .clock-mini {
      width: 120px;
      height: 120px;
    }

    /* SVG lines overlay */
    .lines-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    .match-line {
      stroke: #2196F3;
      stroke-width: 3;
      fill: none;
      stroke-linecap: round;
    }

    .match-line.correct {
      stroke: var(--correct-border);
    }

    .match-line.incorrect {
      stroke: var(--incorrect-border);
      stroke-dasharray: 8, 4;
    }

    .match-line.drawing {
      stroke-dasharray: 5, 5;
    }

    /* Drawing tools */
    .drawing-tools {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
      z-index: 20;
    }

    .tool-btn {
      width: 36px;
      height: 36px;
      border: none;
      background: var(--bg-card);
      cursor: pointer;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-card);
      transition: background 0.2s;
    }

    .tool-btn:hover {
      background: #f0f0f0;
    }

    .tool-btn.active {
      background: #E3F2FD;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <!-- Header -->
    <header class="quiz-header">
      <button class="btn-back" onclick="window.location='index.html'">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Home
      </button>

      <div class="user-profile">
        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=student" alt="Student Avatar" class="user-avatar">
        <div class="progress-bar-container">
          <div class="progress-bar-fill" style="width: 25%"></div>
        </div>
      </div>

      <button class="btn-help">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        Help
      </button>
    </header>

    <!-- Question Meta -->
    <div class="question-meta">
      <span class="badge">MATH</span>
      <span class="question-progress">Question 1 of 8</span>
    </div>

    <!-- Question Title -->
    <div class="question-title">
      <button class="btn-read-aloud" title="Read aloud">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 6c2.5 0 4.5 2 4.5 4.5S14.5 15 12 15"/>
          <path d="M17 5c3 2 5 5 5 7s-2 5-5 7"/>
          <path d="M9.5 9h-5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h5l5 4V5l-5 4z"/>
        </svg>
      </button>
      <h1>Draw a line from each analogue clock to the digital clock that shows the same time</h1>
    </div>

    <!-- Help Bar -->
    <div class="help-bar">
      <div class="help-item">
        <span>Read Aloud</span>
        <span class="help-item-icon">&#128483;</span>
      </div>
      <span class="help-item-line"></span>
      <div class="help-item">
        <span>Get Help</span>
        <span class="help-item-icon">?</span>
      </div>
      <span class="help-item-line"></span>
      <div class="help-item">
        <span>Get Hint</span>
        <span class="help-item-icon">+</span>
      </div>
    </div>

    <!-- Content Card -->
    <div class="content-card">
      <div class="content-card-inner">
        <div class="matching-container" id="matching-container">
          <!-- Drawing tools -->
          <div class="drawing-tools">
            <button class="tool-btn" id="btn-eraser" title="Eraser">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 20H7L3 16l9-9 8 8-4 4"/>
                <path d="M6.5 13.5l4 4"/>
              </svg>
            </button>
            <button class="tool-btn active" id="btn-cursor" title="Select">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/>
              </svg>
            </button>
          </div>

          <!-- SVG for drawing lines -->
          <svg class="lines-svg" id="lines-svg"></svg>

          <div class="matching-grid">
            <!-- Left column: Clocks -->
            <div class="matching-column" id="left-column">
              <div class="matching-item left" data-id="clock-8">
                <div class="clock-mini" id="clock-8"></div>
                <span class="match-dot" data-side="left" data-id="clock-8"></span>
              </div>
              <div class="matching-item left" data-id="clock-3">
                <div class="clock-mini" id="clock-3"></div>
                <span class="match-dot" data-side="left" data-id="clock-3"></span>
              </div>
              <div class="matching-item left" data-id="clock-6">
                <div class="clock-mini" id="clock-6"></div>
                <span class="match-dot" data-side="left" data-id="clock-6"></span>
              </div>
              <div class="matching-item left" data-id="clock-12">
                <div class="clock-mini" id="clock-12"></div>
                <span class="match-dot" data-side="left" data-id="clock-12"></span>
              </div>
            </div>

            <!-- Right column: Digital times -->
            <div class="matching-column" id="right-column">
              <div class="matching-item right" data-id="time-8">
                <span class="match-dot" data-side="right" data-id="time-8"></span>
                <div class="digital-time">8 o'clock</div>
              </div>
              <div class="matching-item right" data-id="time-3">
                <span class="match-dot" data-side="right" data-id="time-3"></span>
                <div class="digital-time">3 o'clock</div>
              </div>
              <div class="matching-item right" data-id="time-6">
                <span class="match-dot" data-side="right" data-id="time-6"></span>
                <div class="digital-time">6 o'clock</div>
              </div>
              <div class="matching-item right" data-id="time-12">
                <span class="match-dot" data-side="right" data-id="time-12"></span>
                <div class="digital-time">12 o'clock</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Feedback -->
    <div class="feedback" id="feedback" style="display: none;">
      <span class="feedback-badge" id="feedback-badge"></span>
      <button class="btn-next">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
    </div>

    <!-- Check Answer Button -->
    <button class="btn-check-answer" id="btn-check">Check Answer</button>
  </div>

  <script src="js/clock.js"></script>
  <script>
    // Create display clocks
    const clockConfigs = [
      { id: 'clock-8', hour: 8 },
      { id: 'clock-3', hour: 3 },
      { id: 'clock-6', hour: 6 },
      { id: 'clock-12', hour: 12 }
    ];

    clockConfigs.forEach(config => {
      new ClockDisplay(`#${config.id}`, config.hour, 0, {
        size: 120,
        showMinuteHand: false
      });
    });

    // Correct matches
    const correctMatches = {
      'clock-8': 'time-8',
      'clock-3': 'time-3',
      'clock-6': 'time-6',
      'clock-12': 'time-12'
    };

    // State
    let matches = {};
    let selectedDot = null;
    const linesSvg = document.getElementById('lines-svg');

    // Dot click handling
    document.querySelectorAll('.match-dot').forEach(dot => {
      dot.addEventListener('click', (e) => {
        const id = dot.dataset.id;
        const side = dot.dataset.side;

        if (!selectedDot) {
          // First selection
          selectedDot = { id, side, element: dot };
          dot.classList.add('selected');
        } else if (selectedDot.side === side) {
          // Same side - switch selection
          selectedDot.element.classList.remove('selected');
          selectedDot = { id, side, element: dot };
          dot.classList.add('selected');
        } else {
          // Different side - make a match
          const leftId = side === 'left' ? id : selectedDot.id;
          const rightId = side === 'right' ? id : selectedDot.id;

          // Remove existing match for this left item
          if (matches[leftId]) {
            removeLine(leftId);
          }

          // Remove existing match to this right item
          Object.keys(matches).forEach(key => {
            if (matches[key] === rightId) {
              removeLine(key);
              delete matches[key];
            }
          });

          // Create new match
          matches[leftId] = rightId;
          drawLine(leftId, rightId);

          // Clear selection
          selectedDot.element.classList.remove('selected');
          selectedDot = null;
        }
      });
    });

    function drawLine(leftId, rightId) {
      const leftDot = document.querySelector(`.match-dot[data-side="left"][data-id="${leftId}"]`);
      const rightDot = document.querySelector(`.match-dot[data-side="right"][data-id="${rightId}"]`);

      if (!leftDot || !rightDot) return;

      const container = document.getElementById('matching-container');
      const containerRect = container.getBoundingClientRect();
      const leftRect = leftDot.getBoundingClientRect();
      const rightRect = rightDot.getBoundingClientRect();

      const x1 = leftRect.left + leftRect.width / 2 - containerRect.left;
      const y1 = leftRect.top + leftRect.height / 2 - containerRect.top;
      const x2 = rightRect.left + rightRect.width / 2 - containerRect.left;
      const y2 = rightRect.top + rightRect.height / 2 - containerRect.top;

      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', x1);
      line.setAttribute('y1', y1);
      line.setAttribute('x2', x2);
      line.setAttribute('y2', y2);
      line.classList.add('match-line');
      line.dataset.leftId = leftId;
      linesSvg.appendChild(line);

      // Highlight matched items
      document.querySelector(`.matching-item[data-id="${leftId}"]`).classList.add('selected');
      document.querySelector(`.matching-item[data-id="${rightId}"]`).classList.add('selected');
    }

    function removeLine(leftId) {
      const line = linesSvg.querySelector(`line[data-left-id="${leftId}"]`);
      if (line) {
        const rightId = matches[leftId];
        line.remove();
        document.querySelector(`.matching-item[data-id="${leftId}"]`)?.classList.remove('selected', 'matched', 'incorrect');
        document.querySelector(`.matching-item[data-id="${rightId}"]`)?.classList.remove('selected', 'matched', 'incorrect');
      }
    }

    // Eraser button
    document.getElementById('btn-eraser').addEventListener('click', () => {
      // Clear all matches
      Object.keys(matches).forEach(key => {
        removeLine(key);
      });
      matches = {};
      // Clear feedback styles
      document.querySelectorAll('.match-line').forEach(l => l.remove());
      document.querySelectorAll('.matching-item').forEach(item => {
        item.classList.remove('selected', 'matched', 'incorrect');
      });
    });

    // Check answers
    const btnCheck = document.getElementById('btn-check');
    const feedback = document.getElementById('feedback');
    const feedbackBadge = document.getElementById('feedback-badge');

    btnCheck.addEventListener('click', () => {
      let allCorrect = true;
      let correctCount = 0;

      // Check each match
      Object.keys(correctMatches).forEach(leftId => {
        const correctRightId = correctMatches[leftId];
        const userRightId = matches[leftId];
        const isCorrect = userRightId === correctRightId;

        const leftItem = document.querySelector(`.matching-item[data-id="${leftId}"]`);
        const line = linesSvg.querySelector(`line[data-left-id="${leftId}"]`);

        if (userRightId) {
          const rightItem = document.querySelector(`.matching-item[data-id="${userRightId}"]`);

          leftItem.classList.remove('selected');
          rightItem.classList.remove('selected');

          if (isCorrect) {
            leftItem.classList.add('matched');
            rightItem.classList.add('matched');
            if (line) line.classList.add('correct');
            correctCount++;
          } else {
            leftItem.classList.add('incorrect');
            rightItem.classList.add('incorrect');
            if (line) line.classList.add('incorrect');
            allCorrect = false;
          }
        } else {
          allCorrect = false;
        }
      });

      feedback.style.display = 'flex';
      feedbackBadge.classList.remove('correct', 'incorrect');

      if (allCorrect) {
        feedbackBadge.classList.add('correct');
        feedbackBadge.innerHTML = '&#10003; All matches correct!';
        btnCheck.style.display = 'none';
      } else {
        feedbackBadge.classList.add('incorrect');
        feedbackBadge.innerHTML = `&#10007; ${correctCount} of 4 correct. Try again!`;
      }
    });
  </script>
</body>
</html>
